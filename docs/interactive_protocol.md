## 交互协议
&nbsp;&nbsp;&nbsp;&nbsp;本文件定义了上位机（或主机）与miniFOC下位机的交互协议。本协议基于[中等容量数据传输协议](https://github.com/ZhuYanzhen1/CDTP/blob/master/mdtp/README.md)的基础上开发，定义了应用层通信的内容。根据中等容量数据传输协议的定义，一个包具有PID（包标识符）和8位的数据字段两部分可编辑的内容，交互协议将定义包内容与控制逻辑间的关系。

***

### 控制包格式

1. 电机控制数据，PID（包标识符）为0。
   | 数据域  |                         内容                          |
   | :-----: | :---------------------------------------------------: |
   | DATA[0] |             电机启停位：0为停止，1为启动              |
   | DATA[1] | 电机工作模式位：0为力矩模式，1为速度模式，2为角度模式 |
   | DATA[2] |      电机期望值高8位，单位符号随电机工作模式确定      |
   | DATA[3] |      电机期望值低8位，单位符号随电机工作模式确定      |
   | DATA[4] |                    保留位，置0x00                     |
   | DATA[5] |                    保留位，置0x00                     |
   | DATA[6] |                    保留位，置0x00                     |
   | DATA[7] |                 前7位数据的CRC8校验和                 |
2. 电机PID参数数据，PID（包标识符）为1。
   | 数据域  |                           内容                           |
   | :-----: | :------------------------------------------------------: |
   | DATA[0] | 电机PID参数模式项：0为力矩模式，1为速度模式，2为角度模式 |
   | DATA[1] |   电机PID参数项：0为Kp，1为Ki，2为Kd，3为抗积分饱和项    |
   | DATA[2] |            PID参数[31:24]，单位0.001，无符号             |
   | DATA[3] |            PID参数[23:16]，单位0.001，无符号             |
   | DATA[4] |             PID参数[15:8]，单位0.001，无符号             |
   | DATA[5] |             PID参数[7:0]，单位0.001，无符号              |
   | DATA[6] |                      保留位，置0x00                      |
   | DATA[7] |                  前7位数据的CRC8校验和                   |

***

### 反馈包格式

1. 电机实时运行数据，PID（包标识符）为0。由miniFOC主动发送，默认发送频率为20Hz。
   | 数据域  |                  内容                   |
   | :-----: | :-------------------------------------: |
   | DATA[0] | 转子机械角高8位，单位为0.02197°，无符号 |
   | DATA[1] | 转子机械角低8位，单位为0.02197°，无符号 |
   | DATA[2] |    转子转速高8位，单位为RPM，有符号     |
   | DATA[3] |    转子转速低8位，单位为RPM，有符号     |
   | DATA[4] |          转子力矩高8位，有符号          |
   | DATA[5] |          转子力矩低8位，有符号          |
   | DATA[6] |      miniFOC温度，单位为℃，有符号       |
   | DATA[7] |          前7位数据的CRC8校验和          |

